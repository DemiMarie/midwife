m4_include([./package.m4])
AT_INIT([[Initial tests]])
AT_COPYRIGHT([[Copyright Â© 2014 Demetrios Obenour.
Licensed under the MIT license; see COPYING for its terms.]])

AT_COLOR_TESTS

m4_define([expected_output],[aasdf

alphabravod
aa
a])
AT_BANNER([[Initial test group]])
AT_SETUP([[Basic file test]])
printf '@%:@! %s/midwife -n2\n%s\n' "${midwife_bindir=../..}" \
';; -*-printf "%s" "aasdf\n\x0a${ad}$1d\012aa\na" -*- a' > script
chmod u+x script
AT_CHECK([[ad=alpha ./script bravo]],[0],m4_defn([expected_output]))
AT_CLEANUP

AT_SETUP([[midwife3 test]])
cat > script <<EOF
@%:@! ${midwife_bindir=../..}/midwife3
;;
;; -*-printf "%s" "aasdf\\n\\x0a\$ad\${1}d\\012aa\\na" -*- a
EOF
chmod u+x script
/bin/time sh -c 'for i in `seq 1000`; do ad=alpha ./script bravo; done' 2>/dev/tty
AT_CHECK([[ad=alpha ./script bravo]],[0],m4_defn([expected_output]))
AT_CLEANUP
